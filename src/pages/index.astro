---
import scheduleData from '../data/structured-schedule-data.json';

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
const now = new Date();
const today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); // –£–±–∏—Ä–∞–µ–º –≤—Ä–µ–º—è, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ DD.MM.YYYY
function parseDate(dateString: string) {
	const [day, month, year] = dateString.split('.');
	return new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
}

// –†–∞–∑–¥–µ–ª—è–µ–º –¥–Ω–∏: –ø—Ä–æ—à–µ–¥—à–∏–µ –∏ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ (–∏—Å–∫–ª—é—á–∞–µ–º –¥–Ω–∏ –±–µ–∑ –∑–∞–Ω—è—Ç–∏–π)
const pastDays = scheduleData.days.filter((day) => {
	const dayDate = parseDate(day.date);
	return dayDate < today && day.lessons.length > 0;
});

const upcomingDays = scheduleData.days.filter((day) => {
	const dayDate = parseDate(day.date);
	return dayDate >= today && day.lessons.length > 0;
});

// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–æ—Å–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
const currentDay = scheduleData.days.find(day => {
	const dayDate = parseDate(day.date);
	return dayDate.getTime() === today.getTime();
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM
function getCurrentTime() {
	const now = new Date();
	return now.toTimeString().slice(0, 5);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å–ª–æ—Ç–µ
function isTimeInSlot(currentTime: string, startTime: string, endTime: string): boolean {
	const current = currentTime.split(':').map(Number);
	const start = startTime.split(':').map(Number);
	const end = endTime.split(':').map(Number);
	
	const currentMinutes = current[0] * 60 + current[1];
	const startMinutes = start[0] * 60 + start[1];
	const endMinutes = end[0] * 60 + end[1];
	
	return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
}


// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–∫–µ
function getCurrentLessonInfo() {
	const currentTime = getCurrentTime();
	
	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–µ–≥–æ–¥–Ω—è –≤—ã—Ö–æ–¥–Ω—ã–º
	const today = new Date();
	const dayOfWeek = today.getDay(); // 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6 = —Å—É–±–±–æ—Ç–∞
	
	// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
	if (!currentDay) {
		// –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ–∫—É—â–µ–º –¥–Ω–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã—Ö–æ–¥–Ω–æ–π –ª–∏ —ç—Ç–æ
		if (dayOfWeek === 0 || dayOfWeek === 6) {
			return {
				hasLesson: false,
				message: "–í—ã—Ö–æ–¥–Ω–æ–π"
			};
		}
		return {
			hasLesson: false,
			message: "–°–µ–π—á–∞—Å –Ω–µ—Ç –∑–∞–Ω—è—Ç–∏–π"
		};
	}
	
	// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã—Ö–æ–¥–Ω–æ–π –ª–∏ —ç—Ç–æ –¥–µ–Ω—å
	if (dayOfWeek === 0 || dayOfWeek === 6) {
		return {
			hasLesson: false,
			message: "–í—ã—Ö–æ–¥–Ω–æ–π"
		};
	}
	
	// –ò—â–µ–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫
	for (const lesson of currentDay.lessons) {
		if (isTimeInSlot(currentTime, lesson.timeSlot.start, lesson.timeSlot.end)) {
			const activity = lesson.lessons[0]; // –ë–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ –∏–∑ —Å–ª–æ—Ç–∞
			return {
				hasLesson: true,
				message: `–°–µ–π—á–∞—Å: ${activity.subject}${activity.room ? ` –≤ ${activity.room}` : ''}${activity.teacher ? ` —Å ${activity.teacher}` : ''}`,
				timeSlot: `${lesson.timeSlot.start} - ${lesson.timeSlot.end}`
			};
		}
	}
	
	// –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞–Ω—è—Ç–∏—è —Å–µ–≥–æ–¥–Ω—è
	if (currentDay.lessons.length === 0) {
		return {
			hasLesson: false,
			message: "–°–µ–π—á–∞—Å –Ω–µ—Ç –∑–∞–Ω—è—Ç–∏–π"
		};
	}
	
	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ª–∏ –≤—Å–µ –∑–∞–Ω—è—Ç–∏—è
	const lastLesson = currentDay.lessons[currentDay.lessons.length - 1];
	if (currentTime > lastLesson.timeSlot.end) {
		return {
			hasLesson: false,
			message: "–í—Å–µ –∑–∞–Ω—è—Ç–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å"
		};
	}
	
	// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏—Å—å –ª–∏ –∑–∞–Ω—è—Ç–∏—è
	const firstLesson = currentDay.lessons[0];
	if (currentTime < firstLesson.timeSlot.start) {
		return {
			hasLesson: false,
			message: `–ó–∞–Ω—è—Ç–∏—è –Ω–∞—á–Ω—É—Ç—Å—è –≤ ${firstLesson.timeSlot.start}`
		};
	}
	
	// –ú–µ–∂–¥—É –∑–∞–Ω—è—Ç–∏—è–º–∏
	return {
		hasLesson: false,
		message: "–°–µ–π—á–∞—Å –ø–µ—Ä–µ—Ä—ã–≤ –º–µ–∂–¥—É –∑–∞–Ω—è—Ç–∏—è–º–∏"
	};
}
---

<html lang="ru">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href={`${import.meta.env.BASE_URL}favicon.svg`} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- PWA Meta Tags -->
		<meta name="application-name" content="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ 1–ú" />
		<meta name="description" content="–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —É—Ä–æ–∫–æ–≤ –∫–ª–∞—Å—Å–∞ 1–ú" />
		<meta name="theme-color" content="#667eea" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="default" />
		<meta name="apple-mobile-web-app-title" content="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ" />
		<meta name="msapplication-TileColor" content="#667eea" />
		<meta name="msapplication-tap-highlight" content="no" />
		
		<!-- PWA Manifest -->
		<link rel="manifest" href={`${import.meta.env.BASE_URL}manifest.json`} />
		
		<!-- Apple Touch Icons -->
		<link rel="apple-touch-icon" href={`${import.meta.env.BASE_URL}icon-192.svg`} />
		<link rel="apple-touch-icon" sizes="152x152" href={`${import.meta.env.BASE_URL}icon-144.svg`} />
		<link rel="apple-touch-icon" sizes="180x180" href={`${import.meta.env.BASE_URL}icon-192.svg`} />
		<link rel="apple-touch-icon" sizes="167x167" href={`${import.meta.env.BASE_URL}icon-144.svg`} />
		
		<!-- Favicons -->
		<link rel="icon" type="image/svg+xml" sizes="192x192" href={`${import.meta.env.BASE_URL}icon-192.svg`} />
		<link rel="icon" type="image/svg+xml" sizes="512x512" href={`${import.meta.env.BASE_URL}icon-512.svg`} />
		
		<link rel="icon" href={`${import.meta.env.BASE_URL}favicon.ico`} />

		<title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ 1–ú</title>
		<style>
			:root {
				--bg-color: #f5f5f5;
				--container-bg: white;
				--text-color: #333;
				--text-secondary: #666;
				--text-muted: #999;
				--border-color: #e0e0e0;
				--card-bg: #fafafa;
				--activity-bg: #f8f9fa;
				--shadow-color: rgba(0, 0, 0, 0.1);
				--gradient-start: #667eea;
				--gradient-end: #764ba2;

				/* –¶–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
				--subject-study: #4CAF50; /* —É—á–µ–±–Ω—ã–π –±–ª–æ–∫ - –∑–µ–ª–µ–Ω—ã–π */
				--subject-english: #2196F3; /* –∞–Ω–≥–ª–∏–π—Å–∫–∏–π - —Å–∏–Ω–∏–π */
				--subject-sport: #FF9800; /* —Å–ø–æ—Ä—Ç - –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
				--subject-walk: #8BC34A; /* –ø—Ä–æ–≥—É–ª–∫–∞ - —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π */
				--subject-lunch: #FF5722; /* –æ–±–µ–¥ - –∫—Ä–∞—Å–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π */
				--subject-choice: #9C27B0; /* –ø–æ –≤—ã–±–æ—Ä—É - —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
				--subject-thinking: #00BCD4; /* –º—ã—à–ª–µ–Ω–∏–µ - –≥–æ–ª—É–±–æ–π */
				--subject-tutor: #3F51B5; /* —Ç—å—é—Ç–æ—Ä—Å–∫–∏–π —á–∞—Å - –∏–Ω–¥–∏–≥–æ */
				--subject-neuron: #E91E63; /* –ù–µ–π—Ä–æ–Ω - —Ä–æ–∑–æ–≤—ã–π */
			}

			@media (prefers-color-scheme: dark) {
				:root {
					--bg-color: #121212;
					--container-bg: #1e1e1e;
					--text-color: #e0e0e0;
					--text-secondary: #b0b0b0;
					--text-muted: #808080;
					--border-color: #2d2d2d;
					--card-bg: #252525;
					--activity-bg: #2a2a2a;
					--shadow-color: rgba(0, 0, 0, 0.3);
					--gradient-start: #4a5d9e;
					--gradient-end: #553677;

					/* –¢–µ–º–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
					--subject-study: #81C784; /* —É—á–µ–±–Ω—ã–π –±–ª–æ–∫ - —Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π */
					--subject-english: #64B5F6; /* –∞–Ω–≥–ª–∏–π—Å–∫–∏–π - —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π */
					--subject-sport: #FFB74D; /* —Å–ø–æ—Ä—Ç - —Ç–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π */
					--subject-walk: #AED581; /* –ø—Ä–æ–≥—É–ª–∫–∞ - —Ç–µ–º–Ω—ã–π —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π */
					--subject-lunch: #FF8A65; /* –æ–±–µ–¥ - —Ç–µ–º–Ω—ã–π –∫—Ä–∞—Å–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π */
					--subject-choice: #BA68C8; /* –ø–æ –≤—ã–±–æ—Ä—É - —Ç–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
					--subject-thinking: #4DD0E1; /* –º—ã—à–ª–µ–Ω–∏–µ - —Ç–µ–º–Ω–æ-–≥–æ–ª—É–±–æ–π */
					--subject-tutor: #7986CB; /* —Ç—å—é—Ç–æ—Ä—Å–∫–∏–π —á–∞—Å - —Ç–µ–º–Ω—ã–π –∏–Ω–¥–∏–≥–æ */
					--subject-neuron: #F06292; /* –ù–µ–π—Ä–æ–Ω - —Ç–µ–º–Ω–æ-—Ä–æ–∑–æ–≤—ã–π */
				}
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				margin: 0;
				background-color: var(--bg-color);
				color: var(--text-color);
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				background: var(--container-bg);
				border-radius: 0;
				box-shadow: 0 4px 6px var(--shadow-color);
			}

			
			@media (min-width: 600px) {
				body {
					padding: 20px;
				}
				
				.container {
					overflow: hidden;
					border-radius: 12px;
				}
			}
			.header {
				background: linear-gradient(135deg, var(--gradient-start) 0%, var(--gradient-end) 100%);
				color: white;
				padding: 30px;
				text-align: center;
				transition: all 0.3s ease;
			}
			.header h1 {
				margin: 0;
				font-size: 2.7rem;
				font-weight: 300;
				transition: font-size 0.3s ease;
			}
			.week-range {
				margin-top: 10px;
				font-size: 1.4rem;
				opacity: 0.9;
				transition: all 0.3s ease;
			}
			.current-day {
				margin-top: 8px;
				font-size: 1.2rem;
				opacity: 0.8;
				background: rgba(255, 255, 255, 0.2);
				padding: 8px 16px;
				border-radius: 20px;
				display: inline-block;
				transition: all 0.3s ease;
			}
			
			/* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —à–∞–ø–∫–∏ */
			@media (max-width: 600px) {
				.header {
					padding: 15px;
				}
				.header h1 {
					font-size: 1.8rem;
				}
				.week-range {
					margin-top: 5px;
					font-size: 1rem;
				}
				.current-day {
					margin-top: 5px;
					font-size: 0.9rem;
					padding: 4px 12px;
				}
				
				
				/* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É–±–∏—Ä–∞–µ–º grid –∏ –¥–µ–ª–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ */
				.schedule-grid {
					display: block;
				}
				
				/* –£–±–∏—Ä–∞–µ–º —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã sticky */
				.day-section {
					border-radius: 0 !important;
					margin-bottom: 0;
				}
			}
			.schedule-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
				gap: 20px;
			}
			.day-section {
				background: var(--card-bg);
				border-radius: 8px;
				margin-bottom: 20px;
			}
			.day-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
				padding: 15px 20px;
				border-bottom: 2px solid var(--border-color);
				background: var(--card-bg);
				position: sticky;
				top: 0;
				z-index: 10;
				box-shadow: 0 2px 4px var(--shadow-color);
			}
			.day-name {
				font-size: 1.6rem;
				font-weight: 600;
				color: var(--text-color);
			}
			.day-date {
				font-size: 1.2rem;
				color: var(--text-secondary);
			}
			.lesson {
				border-radius: 6px;
				padding: 15px 0;
				margin-bottom: 10px;
				box-shadow: 0 2px 4px var(--shadow-color);
			}
			.lesson-time {
				padding: 0 5px;
				font-weight: 600;
				color: var(--gradient-start);
				margin-bottom: 8px;
				font-size: 1.1rem;
			}
			.activity {
				background: var(--activity-bg);
				border-radius: 4px;
				padding: 10px;
				margin-bottom: 8px;
				border-left: 3px solid var(--gradient-start);
				transition: all 0.3s ease;
			}

			/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
			.activity[data-subject="—É—á–µ–±–Ω—ã–π –±–ª–æ–∫"] {
				border-left-color: var(--subject-study);
				background: color-mix(in srgb, var(--subject-study) 10%, var(--activity-bg));
			}
			.activity[data-subject="–∞–Ω–≥–ª–∏–π—Å–∫–∏–π"] {
				border-left-color: var(--subject-english);
				background: color-mix(in srgb, var(--subject-english) 10%, var(--activity-bg));
			}
			.activity[data-subject="—Å–ø–æ—Ä—Ç"] {
				border-left-color: var(--subject-sport);
				background: color-mix(in srgb, var(--subject-sport) 10%, var(--activity-bg));
			}
			.activity[data-subject="–ø—Ä–æ–≥—É–ª–∫–∞"] {
				border-left-color: var(--subject-walk);
				background: color-mix(in srgb, var(--subject-walk) 10%, var(--activity-bg));
			}
			.activity[data-subject="–æ–±–µ–¥"] {
				border-left-color: var(--subject-lunch);
				background: color-mix(in srgb, var(--subject-lunch) 10%, var(--activity-bg));
			}
			.activity[data-subject="–ø–æ –≤—ã–±–æ—Ä—É"] {
				border-left-color: var(--subject-choice);
				background: color-mix(in srgb, var(--subject-choice) 10%, var(--activity-bg));
			}
			.activity[data-subject="–º—ã—à–ª–µ–Ω–∏–µ"] {
				border-left-color: var(--subject-thinking);
				background: color-mix(in srgb, var(--subject-thinking) 10%, var(--activity-bg));
			}
			.activity[data-subject="—Ç—å—é—Ç–æ—Ä—Å–∫–∏–π —á–∞—Å"] {
				border-left-color: var(--subject-tutor);
				background: color-mix(in srgb, var(--subject-tutor) 10%, var(--activity-bg));
			}
			.activity[data-subject="–ù–µ–π—Ä–æ–Ω"] {
				border-left-color: var(--subject-neuron);
				background: color-mix(in srgb, var(--subject-neuron) 10%, var(--activity-bg));
			}
			.activity:last-child {
				margin-bottom: 0;
			}
			.subject {
				font-weight: 600;
				color: var(--text-color);
				margin-bottom: 4px;
			}
			.teacher, .room {
				font-size: 1.1rem;
				color: var(--text-secondary);
				margin-bottom: 2px;
			}
			.no-lessons {
				text-align: center;
				color: var(--text-muted);
				font-style: italic;
				padding: 20px;
			}
			.metadata {
				background: var(--activity-bg);
				padding: 20px 30px;
				border-top: 1px solid var(--border-color);
				font-size: 1.1rem;
				color: var(--text-secondary);
			}
			
			/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–æ—Å–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ */
			.time-indicator {
				position: absolute;
				left: 0;
				right: 0;
				height: 2px;
				background: #ea4335;
				z-index: 10;
				box-shadow: 0 0 10px rgba(234, 67, 53, 0.5);
				transition: top 0.3s ease;
			}
			
			.time-indicator::before {
				content: '';
				position: absolute;
				left: -6px;
				top: -4px;
				width: 10px;
				height: 10px;
				background: #ea4335;
				border-radius: 50%;
				box-shadow: 0 0 5px rgba(234, 67, 53, 0.8);
			}
			
			.time-indicator::after {
				content: attr(data-time);
				position: absolute;
				right: 10px;
				top: -8px;
				background: #ea4335;
				color: white;
				padding: 2px 6px;
				border-radius: 3px;
				font-size: 13px;
				font-weight: 500;
				white-space: nowrap;
			}
			
			.day-content {
				position: relative;
				padding: 0 20px 20px 20px;
			}
			
			.lesson-slot {
				position: relative;
				border-radius: 6px;
				padding: 15px 0;
				margin-bottom: 10px;
				box-shadow: 0 2px 4px var(--shadow-color);
				transition: all 0.3s ease;
				background: var(--card-bg);
			}
			
			.lesson-slot.current-slot {
				background: linear-gradient(135deg, 
					color-mix(in srgb, var(--gradient-start) 10%, var(--card-bg)) 0%,
					color-mix(in srgb, var(--gradient-end) 10%, var(--card-bg)) 100%
				);
				border: 2px solid var(--gradient-start);
				box-shadow: 0 4px 12px color-mix(in srgb, var(--gradient-start) 20%, transparent);
			}

			.current-slot .activity {
				border: none;
			}
			
			.lesson-slot.past-slot {
				opacity: 0.6;
				background: color-mix(in srgb, var(--card-bg) 80%, black);
			}
			
			.lesson-slot.future-slot {
				background: var(--card-bg);
			}
			
			
			/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
			@keyframes slideDown {
				from {
					opacity: 0;
					transform: translateX(-50%) translateY(-20px);
				}
				to {
					opacity: 1;
					transform: translateX(-50%) translateY(0);
				}
			}
			
			@keyframes slideUp {
				from {
					opacity: 1;
					transform: translateX(-50%) translateY(0);
				}
				to {
					opacity: 0;
					transform: translateX(-50%) translateY(-20px);
				}
			}
			
			/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ —Å–æ–±—ã—Ç–∏–π */
			.events-section {
				background: var(--card-bg);
				margin: 20px;
				border-radius: 12px;
				box-shadow: 0 2px 8px var(--shadow-color);
				overflow: hidden;
			}
			
			.events-section h2 {
				margin: 0 0 20px 0;
				font-size: 1.6rem;
				font-weight: 600;
				color: var(--text-color);
				padding: 0 20px;
			}
			
			.events-list {
				padding: 20px;
			}
			
			.event-item {
				background: var(--activity-bg);
				border-radius: 8px;
				padding: 15px;
				margin-bottom: 15px;
				border-left: 4px solid var(--gradient-start);
				transition: all 0.3s ease;
				position: relative;
			}
			
			.event-item:hover {
				transform: translateY(-2px);
				box-shadow: 0 4px 12px var(--shadow-color);
			}
			
			.event-item:last-child {
				margin-bottom: 0;
			}
			
			.event-date {
				font-size: 1.1rem;
				font-weight: 600;
				color: var(--gradient-start);
				margin-bottom: 8px;
			}
			
			.event-title {
				font-size: 1.2rem;
				font-weight: 600;
				color: var(--text-color);
				margin-bottom: 8px;
				line-height: 1.4;
			}
			
			
			.event-location {
				font-size: 1rem;
				color: var(--text-secondary);
				margin-bottom: 12px;
			}
			
			.event-actions {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
			}
			
			.event-btn {
				background: var(--gradient-start);
				color: white;
				border: none;
				padding: 8px 16px;
				border-radius: 20px;
				font-size: 0.9rem;
				font-weight: 500;
				text-decoration: none;
				display: inline-flex;
				align-items: center;
				gap: 6px;
				transition: all 0.3s ease;
				cursor: pointer;
			}
			
			.event-btn:hover {
				background: var(--gradient-end);
				transform: translateY(-1px);
				box-shadow: 0 2px 8px color-mix(in srgb, var(--gradient-start) 30%, transparent);
			}
			
			
			.no-events {
				text-align: center;
				color: var(--text-muted);
				font-style: italic;
				padding: 40px 20px;
			}
			
			@media (max-width: 600px) {
				.events-section {
					margin: 10px;
					border-radius: 8px;
				}
				
				.events-section h2 {
					font-size: 1.4rem;
					padding: 0 15px;
				}
				
				.events-list {
					padding: 15px;
				}
				
				.event-item {
					padding: 12px;
				}
				
				.event-title {
					font-size: 1.1rem;
				}
				
				.event-btn {
					justify-content: center;
				}
			}

			/* –ü—Ä–æ—à–µ–¥—à–∏–µ –¥–Ω–∏: details/summary */
			.past-days {
				margin: 20px;
			}
			.past-day {
				background: var(--card-bg);
				border-radius: 8px;
				box-shadow: 0 2px 6px var(--shadow-color);
				margin-bottom: 12px;
				overflow: hidden;
			}
			.past-day summary {
				list-style: none;
				cursor: pointer;
				padding: 14px 20px;
				border-bottom: 1px solid var(--border-color);
				background: var(--card-bg);
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			.past-day summary::-webkit-details-marker { display: none; }
			.past-day .past-link {
				color: var(--gradient-start);
				text-decoration: underline;
				font-weight: 600;
			}
			.past-day .day-date {
				color: var(--text-secondary);
				font-weight: 500;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤</h1>
				<div class="week-range">{scheduleData.weekRange}</div>
				<div class="current-day">{getCurrentLessonInfo().message}</div>
			</div>
			
			<!-- –ë–ª–æ–∫ –±–ª–∏–∂–∞–π—à–∏—Ö —Å–æ–±—ã—Ç–∏–π -->
			<div class="events-section">
				<h2>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h2>
				<div class="events-list">
					<div class="event-item">
						<div class="event-date">26 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 16:00</div>
						<div class="event-title">–°–µ—Ä–¥–µ—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—â–µ–π ‚Äì —Å–µ–º–µ–π–Ω–æ–µ —á–∞–µ–ø–∏—Ç–∏–µ –ø–µ—Ä–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤!</div>
						<div class="event-location">üìç —à–∫–æ–ª–∞ –ò–ª–ò</div>
						<div class="event-actions">
							<a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=–°–µ—Ä–¥–µ—á–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—â–µ–π ‚Äì —Å–µ–º–µ–π–Ω–æ–µ —á–∞–µ–ø–∏—Ç–∏–µ –ø–µ—Ä–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤!&dates=20240926T130000Z/20240926T140000Z&details=26 —Å–µ–Ω—Ç—è–±—Ä—è, –≤ 16:00, –∂–¥–µ–º –≤–∞—Å –≤ —à–∫–æ–ª–µ –ò–ª–ò ‚Äì –±—É–¥–µ–º –µ—â—ë –±–ª–∏–∂–µ –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è, –∏–≥—Ä–∞—Ç—å –∏, –∫–æ–Ω–µ—á–Ω–æ, –ø–∏—Ç—å —á–∞–π —Å —É–≥–æ—â–µ–Ω–∏—è–º–∏.&location=—à–∫–æ–ª–∞ –ò–ª–ò" target="_blank" rel="noopener" class="event-btn">
								üìÖ –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
							</a>
						</div>
					</div>
				</div>
			</div>
			
			{pastDays.length > 0 && (
				<div class="past-days">
					{pastDays.map((day) => (
						<details class="past-day">
							<summary>
								<a class="past-link">{day.dayName}</a>
								<span class="day-date">{day.date}</span>
							</summary>
							<div class="day-content">
								{day.lessons.map((lesson) => (
									<div class="lesson-slot" data-start={lesson.timeSlot.start} data-end={lesson.timeSlot.end}>
										<div class="lesson-time">{lesson.timeSlot.start} - {lesson.timeSlot.end}</div>
										{lesson.lessons.map((activity) => (
											<div class="activity" data-subject={activity.subject}>
												<div class="subject">{activity.subject}</div>
												{activity.teacher && <div class="teacher">üë®‚Äçüè´ {activity.teacher}</div>}
												{activity.room && <div class="room">üè¢ {activity.room}</div>}
											</div>
										))}
									</div>
								))}
							</div>
						</details>
					))}
				</div>
			)}

			<div class="schedule-grid">
				{upcomingDays.map((day) => {
					const isCurrentDay = parseDate(day.date).getTime() === today.getTime();
					
					return (
						<div class="day-section">
							<div class="day-header">
								<div class="day-name">{day.dayName}</div>
								<div class="day-date">{day.date}</div>
							</div>
							
							<div class="day-content">
								{/* timeIndicator —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –≤ ensureTimeIndicatorExists() */}
								
								{day.lessons.map((lesson, index) => {
									let slotClass = 'lesson-slot';
									
									// –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
									if (isCurrentDay) {
										const currentTime = getCurrentTime();
										const isCurrent = isTimeInSlot(currentTime, lesson.timeSlot.start, lesson.timeSlot.end);
										const isPast = currentTime > lesson.timeSlot.end;
										const isFuture = currentTime < lesson.timeSlot.start;
										
										if (isCurrent) slotClass += ' current-slot';
										else if (isPast) slotClass += ' past-slot';
										else if (isFuture) slotClass += ' future-slot';
									}
									
									return (
										<div class={slotClass} data-start={lesson.timeSlot.start} data-end={lesson.timeSlot.end}>
											<div class="lesson-time">{lesson.timeSlot.start} - {lesson.timeSlot.end}</div>
											{lesson.lessons.map((activity) => (
												<div class="activity" data-subject={activity.subject}>
													<div class="subject">{activity.subject}</div>
													{activity.teacher && <div class="teacher">üë®‚Äçüè´ {activity.teacher}</div>}
													{activity.room && <div class="room">üè¢ {activity.room}</div>}
												</div>
											))}
										</div>
									);
								})}
							</div>
						</div>
					);
				})}
			</div>
			
			<div class="metadata">
				<p><strong>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.</strong></p>
				<p>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å —Å–∞–π—Ç–∞ <a href="https://schedule.mstimetables.ru/" target="_blank" rel="noopener">schedule.mstimetables.ru</a>.</p>
				<p>–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞: {new Date(scheduleData.metadata.lastModified).toLocaleString('ru-RU')}</p>
			</div>
		</div>
		
		<script>
			// @ts-nocheck
			
			// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–ø–æ–¥–¥–µ—Ä–∂–∫–∏
			let isOnline = navigator.onLine;
			let serviceWorkerRegistration = null;
			
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å–ª–æ—Ç–µ (–¥—É–±–ª–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ª–æ–≥–∏–∫—É)
			/**
			 * @param {string} currentTime
			 * @param {string} startTime
			 * @param {string} endTime
			 * @returns {boolean}
			 */
			function isTimeInSlot(/** @type {string} */ currentTime, /** @type {string} */ startTime, /** @type {string} */ endTime) {
				const current = currentTime.split(':').map(Number);
				const start = startTime.split(':').map(Number);
				const end = endTime.split(':').map(Number);
				
				const currentMinutes = current[0] * 60 + current[1];
				const startMinutes = start[0] * 60 + start[1];
				const endMinutes = end[0] * 60 + end[1];
				
				return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
			}
			
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–∫–µ (–¥—É–±–ª–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ª–æ–≥–∏–∫—É)
			function getCurrentLessonInfo() {
				const currentTime = new Date().toTimeString().slice(0, 5);
				const indicator = document.getElementById('timeIndicator');
				const currentDayContainer = indicator ? indicator.closest('.day-section') : document.querySelector('.day-section');
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–µ–≥–æ–¥–Ω—è –≤—ã—Ö–æ–¥–Ω—ã–º
				const today = new Date();
				const dayOfWeek = today.getDay(); // 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 6 = —Å—É–±–±–æ—Ç–∞
				
				if (!currentDayContainer) {
					// –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ–∫—É—â–µ–º –¥–Ω–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã—Ö–æ–¥–Ω–æ–π –ª–∏ —ç—Ç–æ
					if (dayOfWeek === 0 || dayOfWeek === 6) {
						return {
							hasLesson: false,
							message: "–í—ã—Ö–æ–¥–Ω–æ–π"
						};
					}
					return {
						hasLesson: false,
						message: "–°–µ–π—á–∞—Å –Ω–µ—Ç –∑–∞–Ω—è—Ç–∏–π"
					};
				}
				
				// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã—Ö–æ–¥–Ω–æ–π –ª–∏ —ç—Ç–æ –¥–µ–Ω—å
				if (dayOfWeek === 0 || dayOfWeek === 6) {
					return {
						hasLesson: false,
						message: "–í—ã—Ö–æ–¥–Ω–æ–π"
					};
				}
				
				const lessonSlots = currentDayContainer.querySelectorAll('.lesson-slot');
				
				// –ò—â–µ–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫
				for (const slot of lessonSlots) {
					const startTime = slot.getAttribute('data-start');
					const endTime = slot.getAttribute('data-end');
					
					if (startTime && endTime && isTimeInSlot(currentTime, startTime, endTime)) {
						const activity = slot.querySelector('.activity');
						if (activity) {
							const subject = activity.querySelector('.subject')?.textContent || '';
							const teacher = activity.querySelector('.teacher')?.textContent?.replace('üë®‚Äçüè´ ', '') || '';
							const room = activity.querySelector('.room')?.textContent?.replace('üè¢ ', '') || '';
							
							let message = `–°–µ–π—á–∞—Å: ${subject}`;
							if (room) message += ` –≤ ${room}`;
							if (teacher) message += ` —Å ${teacher}`;
							
							return {
								hasLesson: true,
								message: message,
								timeSlot: `${startTime} - ${endTime}`
							};
						}
					}
				}
				
				// –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
				if (lessonSlots.length === 0) {
					return {
						hasLesson: false,
						message: "–°–µ–π—á–∞—Å –Ω–µ—Ç –∑–∞–Ω—è—Ç–∏–π"
					};
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –ª–∏ –≤—Å–µ –∑–∞–Ω—è—Ç–∏—è
				const lastSlot = lessonSlots[lessonSlots.length - 1];
				const lastEndTime = lastSlot.getAttribute('data-end');
				if (lastEndTime && currentTime > lastEndTime) {
					return {
						hasLesson: false,
						message: "–í—Å–µ –∑–∞–Ω—è—Ç–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å"
					};
				}
				
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏—Å—å –ª–∏ –∑–∞–Ω—è—Ç–∏—è
				const firstSlot = lessonSlots[0];
				const firstStartTime = firstSlot.getAttribute('data-start');
				if (firstStartTime && currentTime < firstStartTime) {
					return {
						hasLesson: false,
						message: `–ó–∞–Ω—è—Ç–∏—è –Ω–∞—á–Ω—É—Ç—Å—è –≤ ${firstStartTime}`
					};
				}
				
				// –ú–µ–∂–¥—É –∑–∞–Ω—è—Ç–∏—è–º–∏
				return {
					hasLesson: false,
					message: "–°–µ–π—á–∞—Å –ø–µ—Ä–µ—Ä—ã–≤ –º–µ–∂–¥—É –∑–∞–Ω—è—Ç–∏—è–º–∏"
				};
			}
			
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–∫–µ
			function updateCurrentLessonInfo() {
				const currentDayElement = document.querySelector('.current-day');
				if (currentDayElement) {
					const lessonInfo = getCurrentLessonInfo();
					currentDayElement.textContent = lessonInfo.message;
				}
			}
			
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–æ—Å–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
			function updateTimeIndicator() {
				const timeIndicator = document.getElementById('timeIndicator');
				if (!timeIndicator) return;
				
				const currentTime = new Date();
				const currentTimeString = currentTime.toTimeString().slice(0, 5);
				
				// –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–ª–æ—Ç –≤ —Ç–µ–∫—É—â–µ–º –¥–Ω–µ
				const currentSlot = document.querySelector('.current-slot');
				const container = timeIndicator.parentElement;
				
				if (currentSlot && container) {
					const slotRect = currentSlot.getBoundingClientRect();
					const containerRect = container.getBoundingClientRect();
					
					// –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–ª–æ—Å–∫—É –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–Ω—è
					const relativeTop = slotRect.top - containerRect.top;
					const slotHeight = slotRect.height;
					const startTime = currentSlot.getAttribute('data-start');
					const endTime = currentSlot.getAttribute('data-end');
					
					if (startTime && endTime) {
						// –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ—Ç–∞
						const startMinutes = parseInt(startTime.split(':')[0]) * 60 + parseInt(startTime.split(':')[1]);
						const endMinutes = parseInt(endTime.split(':')[0]) * 60 + parseInt(endTime.split(':')[1]);
						const currentMinutes = currentTime.getHours() * 60 + currentTime.getMinutes();
						
						const progress = (currentMinutes - startMinutes) / (endMinutes - startMinutes);
						const positionInSlot = progress * slotHeight;
						
						timeIndicator.style.top = (relativeTop + positionInSlot) + 'px';
						timeIndicator.style.display = 'block';
						timeIndicator.setAttribute('data-time', currentTimeString);
					}
				} else {
					timeIndicator.style.display = 'none';
				}
				
				// –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª–æ—Ç–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º –¥–Ω–µ
				const currentDayContainer = timeIndicator.parentElement;
				if (currentDayContainer) {
					currentDayContainer.querySelectorAll('.lesson-slot').forEach(slot => {
						const startTime = slot.getAttribute('data-start');
						const endTime = slot.getAttribute('data-end');
						const currentTimeStr = currentTimeString;
						
						if (startTime && endTime) {
							slot.classList.remove('current-slot', 'past-slot', 'future-slot');
							
							if (isTimeInSlot(currentTimeStr, startTime, endTime)) {
								slot.classList.add('current-slot');
							} else if (currentTimeStr > endTime) {
								slot.classList.add('past-slot');
							} else if (currentTimeStr < startTime) {
								slot.classList.add('future-slot');
							}
						}
					});
				}
			}

			// –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
			function ensureTimeIndicatorExists() {
				if (document.getElementById('timeIndicator')) return;

				// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –∫–∞–∫ DD.MM.YYYY
				const now = new Date();
				const dd = String(now.getDate()).padStart(2, '0');
				const mm = String(now.getMonth() + 1).padStart(2, '0');
				const yyyy = String(now.getFullYear());
				const todayStr = `${dd}.${mm}.${yyyy}`;

				const daySections = document.querySelectorAll('.day-section');
				for (const section of daySections) {
					const dateEl = section.querySelector('.day-date');
					if (dateEl && dateEl.textContent && dateEl.textContent.trim() === todayStr) {
						const dayContent = section.querySelector('.day-content');
						if (dayContent) {
							const indicator = document.createElement('div');
							indicator.id = 'timeIndicator';
							indicator.className = 'time-indicator';
							indicator.style.display = 'none';
							dayContent.prepend(indicator);
						}
						break;
					}
				}
			}
			
			// –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–µ—Ä–≤–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
			ensureTimeIndicatorExists();
			updateTimeIndicator();
			updateCurrentLessonInfo();
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
			window.addEventListener('scroll', updateTimeIndicator);
			window.addEventListener('resize', updateTimeIndicator);
			
			// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–ø–æ–¥–¥–µ—Ä–∂–∫–∏
			function updateOnlineStatus() {
				isOnline = navigator.onLine;
			}
			
			function showOfflineMessage() {
				const message = document.createElement('div');
				message.id = 'offlineMessage';
				message.style.cssText = `
					position: fixed;
					top: 20px;
					left: 50%;
					transform: translateX(-50%);
					background: color-mix(in srgb, var(--gradient-start) 80%, black);
					color: white;
					padding: 15px 25px;
					border-radius: 25px;
					box-shadow: 0 4px 12px var(--shadow-color);
					z-index: 1000;
					font-size: 14px;
					animation: slideDown 0.3s ease;
				`;
				message.innerHTML = 'üì° –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.';
				document.body.appendChild(message);
				
				// –£–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
				setTimeout(() => {
					if (message.parentNode) {
						message.style.animation = 'slideUp 0.3s ease';
						setTimeout(() => message.remove(), 300);
					}
				}, 5000);
			}
			
			function hideOfflineMessage() {
				const message = document.getElementById('offlineMessage');
				if (message) {
					message.style.animation = 'slideUp 0.3s ease';
					setTimeout(() => message.remove(), 300);
				}
			}
			
			// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA
			if ('serviceWorker' in navigator) {
				window.addEventListener('load', () => {
					navigator.serviceWorker.register(`${import.meta.env.BASE_URL}sw.js`)
						.then((registration) => {
							serviceWorkerRegistration = registration;
							
							// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
							registration.addEventListener('updatefound', () => {
								const newWorker = registration.installing;
								newWorker.addEventListener('statechange', () => {
									if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
										// –ù–æ–≤—ã–π SW –≥–æ—Ç–æ–≤, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
										if (confirm('–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–Ω–æ–≤–∏—Ç—å —Å–µ–π—á–∞—Å?')) {
											newWorker.postMessage({ type: 'SKIP_WAITING' });
											window.location.reload();
										}
									}
								});
							});
						})
						.catch((registrationError) => {
							// –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker
						});
				});
			}
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
			let deferredPrompt;
			window.addEventListener('beforeinstallprompt', (e) => {
				// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
				e.preventDefault();
				// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
				deferredPrompt = e;
			});
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
			window.addEventListener('appinstalled', (evt) => {
				// PWA —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
			});
			
			// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
			window.addEventListener('online', () => {
				updateOnlineStatus();
				hideOfflineMessage();
			});
			
			window.addEventListener('offline', () => {
				updateOnlineStatus();
				showOfflineMessage();
			});
			
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
			function handleNetworkError(error, context) {
				if (!isOnline) {
					showOfflineMessage();
				} else {
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å–µ—Ç–∏
					const message = document.createElement('div');
					message.style.cssText = `
						position: fixed;
						top: 20px;
						left: 50%;
						transform: translateX(-50%);
						background: color-mix(in srgb, var(--gradient-end) 80%, black);
						color: white;
						padding: 15px 25px;
						border-radius: 25px;
						box-shadow: 0 4px 12px var(--shadow-color);
						z-index: 1000;
						font-size: 14px;
						animation: slideDown 0.3s ease;
					`;
					message.innerHTML = '‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.';
					document.body.appendChild(message);
					
					setTimeout(() => {
						if (message.parentNode) {
							message.style.animation = 'slideUp 0.3s ease';
							setTimeout(() => message.remove(), 300);
						}
					}, 4000);
				}
			}
			
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
			async function safeFetch(url, options = {}) {
				try {
					const response = await fetch(url, options);
					if (!response.ok) {
						throw new Error(`HTTP ${response.status}: ${response.statusText}`);
					}
					return response;
				} catch (error) {
					handleNetworkError(error, 'safeFetch');
					throw error;
				}
			}
			
			// –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
			const originalFetch = window.fetch;
			window.fetch = async function(...args) {
				try {
					return await originalFetch.apply(this, args);
				} catch (error) {
					handleNetworkError(error, 'fetch');
					throw error;
				}
			};
			
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
			updateOnlineStatus();
		</script>
	</body>
</html>
